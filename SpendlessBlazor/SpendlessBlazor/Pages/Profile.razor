@page "/profile"

@using SpendlessBlazor.Pages
@using System.Linq
@inject SpendlessBlazor.Services.IInfoService InfoService

<h1>Profile (dummy)</h1>


<div class="gap-4 d-flex flex-wrap">
    <MudTextField @bind-Value="textValue" Label="Enter your name" Variant="Variant.Outlined"></MudTextField>
    @code {
        public string? textValue { get; set; }
}
    <MudTextField @bind-Value="income" Label="Income" Variant="Variant.Outlined" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.AttachMoney" />
    @code {
        public double income { get; set; } = 0;
    }
</div>
<br />
<button class="btn btn-primary" >Save</button>
<br />
<br />

<h3>Balance: @Balance()</h3>

<br />
<br />

<MudSimpleTable Dense="@dense" Hover="@hover" Bordered="@bordered" Striped="@striped" Style="overflow-x: auto;">
    <thead>
        <tr>
            @foreach (var h in headings)
            {
                <th>@h</th>
            }
        </tr>
    </thead>
    <tbody>
        @{
            if (infoList != null)
                foreach (var tempCategory in Expenses.categoryValues)
                {
                    if (categoryExpenses(tempCategory, infoList) != 0)
                    {
                        <tr>
                            <td>@tempCategory</td>
                            <td>@categoryExpenses(tempCategory, infoList)</td>
                        </tr>
                    }
                }
        }
    </tbody>
</MudSimpleTable>
@code {
    private bool dense = false;
    private bool hover = true;
    private bool striped = false;
    private bool bordered = false;

    string[] headings = { "Category", "Total expenses" };
}


@code {

    public List<Info> infoList { get; set; } = Expenses.info;


    public double TotalExpenses(List<Info> info)
    {
        return info.Where(item => item.amount > 0).Sum(item => item.amount);
    }

    public double categoryExpenses(String category, List<Info> info)
    {
        return Math.Round(info.Where(item => item.categoryValue == category && item.amount > 0).Sum(item => item.amount));
    }

    public double Balance()
    {
        return Math.Round(income - TotalExpenses(infoList), 2);
    }

    protected override async Task OnInitializedAsync()
    {
        infoList = InfoService.ReadJson();
        // In real life use an asynchronous function for fetching data from an api.
        await Task.Delay(5);
    }
}

